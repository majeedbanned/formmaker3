# ایجاد مدرسه جدید (Create New School)

این صفحه امکان ایجاد مدرسه‌های جدید را فراهم می‌کند.

## ویژگی‌ها

- ایجاد پایگاه داده جدید برای هر مدرسه
- کپی کردن جداول اساسی از پایگاه داده اصلی
- به‌روزرسانی اطلاعات کپی شده با ورودی‌های کاربر
- مدیریت پایگاه‌های داده (مشاهده لیست و حذف)
- رابط کاربری ساده و کاربرپسند
- اعتبارسنجی ورودی‌ها
- نمایش پیام‌های موفقیت و خطا

## جداول کپی شده

هنگام ایجاد مدرسه جدید، جداول زیر از پایگاه داده `files` کپی می‌شوند:

1. **schools** - اطلاعات مدارس
2. **adminsystemmenues** - منوهای سیستم مدیریت
3. **adminsystems** - سیستم‌های مدیریتی
4. **pageModules** - ماژول‌های صفحات

## استفاده

### ورود به سیستم

1. به صفحه `/admin/createnewschool` بروید
2. رمز عبور `admin123` را وارد کنید
3. دکمه "ورود" را کلیک کنید

### ایجاد مدرسه جدید

1. پس از ورود موفق، فرم را با اطلاعات زیر پر کنید:
   - **نام مدرسه**: نام کامل مدرسه
   - **نام پایگاه داده**: نام منحصر به فرد برای پایگاه داده جدید
   - **دامنه**: دامنه‌ای که مدرسه استفاده خواهد کرد
   - **کد مدرسه**: کد منحصر به فرد مدرسه (همچنین به عنوان نام کاربری و رمز عبور استفاده می‌شود)
   - **مقطع تحصیلی**: انتخاب مقطع تحصیلی مدرسه
3. دکمه "ایجاد مدرسه جدید" را کلیک کنید
4. منتظر تکمیل عملیات باشید

### مدیریت پایگاه‌های داده

1. در بخش سمت راست صفحه، لیست تمام پایگاه‌های داده را مشاهده کنید
2. برای بروزرسانی لیست، دکمه "بروزرسانی لیست" را کلیک کنید
3. برای حذف یک پایگاه داده، دکمه "حذف" مربوط به آن را کلیک کنید
4. عملیات حذف نیاز به تایید دارد

### خروج از سیستم

- برای خروج از سیستم، دکمه "خروج از سیستم" در بالای صفحه را کلیک کنید

## محدودیت‌ها

- نام پایگاه داده باید منحصر به فرد باشد
- نام پایگاه داده فقط می‌تواند شامل حروف انگلیسی، اعداد، خط تیره و زیرخط باشد
- در صورت وجود پایگاه داده با همان نام، خطا نمایش داده می‌شود

## API Endpoints

### ایجاد مدرسه جدید

```
POST /api/admin/create-new-school
```

#### Request Body

```json
{
  "databaseName": "school_name",
  "domain": "example.com", 
  "schoolCode": "SCH001",
  "schoolName": "مدرسه نمونه",
  "maghta": "1"
}
```

#### Response

```json
{
  "success": true,
  "message": "پایگاه داده با موفقیت ایجاد شد"
}
```

### لیست پایگاه‌های داده

```
GET /api/admin/list-databases
```

#### Response

```json
{
  "success": true,
  "databases": [
    {
      "name": "school1",
      "size": 1048576
    }
  ]
}
```

### حذف پایگاه داده

```
DELETE /api/admin/delete-database
```

#### Request Body

```json
{
  "databaseName": "school_name"
}
```

#### Response

```json
{
  "success": true,
  "message": "پایگاه داده با موفقیت حذف شد"
}
```

## تنظیم ناوبری

برای اضافه کردن این صفحه به منوی ناوبری، از endpoint زیر استفاده کنید:

```
POST /api/admin/setup-navigation
```

## تغییرات اعمال شده روی داده‌ها

هنگام ایجاد مدرسه جدید، تغییرات زیر روی داده‌های کپی شده اعمال می‌شود:

### جدول schools
- `data.schoolName` → نام مدرسه وارد شده
- `data.schoolCode` → کد مدرسه وارد شده
- `data.username` → کد مدرسه (به عنوان نام کاربری)
- `data.password` → کد مدرسه (به عنوان رمز عبور)
- `data.domain` → دامنه وارد شده
- `data.maghta` → مقطع تحصیلی انتخاب شده

### جدول pageModules
- `schoolId` → کد مدرسه وارد شده

## ملاحظات امنیتی

- این صفحه فقط برای مدیران سیستم در نظر گرفته شده است
- **رمز عبور هاردکد شده**: `admin123` (در محیط تولید باید تغییر کند)
- سیستم ورود محلی فقط برای این صفحه فعال است
- اطلاعات اتصال به پایگاه داده باید در متغیرهای محیطی قرار گیرند
- اعتبارسنجی ورودی‌ها در سمت سرور انجام می‌شود
- پایگاه‌های داده سیستمی (admin, config, local, files, masterdb) از حذف محافظت شده‌اند
- عملیات حذف پایگاه داده نیاز به تایید کاربر دارد

## خطایابی

در صورت بروز خطا:

1. لاگ‌های سرور را بررسی کنید
2. اتصال به MongoDB را تست کنید
3. مجوزهای پایگاه داده را بررسی کنید
4. از منحصر به فرد بودن نام پایگاه داده اطمینان حاصل کنید

